# STORY-004: Re-integrate Firebase (Analytics & Crashlytics)

## Story Type
Technical Debt / Enhancement

## Priority
Medium

## Description
Re-add Firebase Core, Analytics, and Crashlytics after initial app release. Firebase was temporarily removed to simplify the initial build and eliminate compilation errors.

## Background
Firebase was removed in commit f95dea4 to:
- Eliminate `firebase_options.dart` compilation errors
- Simplify dependencies for MVP
- Allow demo mode to work without external dependencies

Currently, analytics are logged via Talker (local logs only).

## Acceptance Criteria
- [ ] Add Firebase dependencies back to pubspec.yaml
- [ ] Generate fresh firebase_options.dart using flutterfire CLI
- [ ] Replace TalkerAnalyticsService with FirebaseAnalyticsService
- [ ] Restore Crashlytics test buttons in Settings
- [ ] Verify analytics events appear in Firebase console
- [ ] Test on iOS, Android, and Web
- [ ] No compilation errors

## Implementation Steps

### 1. Setup Firebase Project
```bash
# Install flutterfire CLI
dart pub global activate flutterfire_cli

# Configure Firebase
flutterfire configure --project=memverse-flutter
```

### 2. Add Dependencies
```yaml
dependencies:
  firebase_core: ^3.15.2
  firebase_analytics: ^11.6.0
  firebase_crashlytics: ^4.3.10
  firebase_messaging: ^15.0.0  # Optional for push notifications
```

### 3. Update Code
- Restore firebase_options.dart (generated by flutterfire)
- Update main.dart to call `Firebase.initializeApp()`
- Replace TalkerAnalyticsService with FirebaseAnalyticsService
- Rename firebase_analytics_service.dart.disabled back to .dart
- Restore Crashlytics in settings_screen.dart

### 4. Test
- Run on iOS, Android, Web
- Verify events in Firebase console
- Test crash reporting

## Files to Update
- `pubspec.yaml` - Add Firebase dependencies
- `lib/main.dart` - Initialize Firebase
- `lib/firebase_options.dart` - Generate fresh
- `lib/src/services/analytics_providers.dart` - Use FirebaseAnalyticsService
- `lib/src/services/firebase_analytics_service.dart.disabled` - Rename and update
- `lib/src/features/settings/presentation/views/settings_screen.dart` - Restore crash test buttons
- `lib/src/features/demo/presentation/views/blurrable_verse_view.dart` - Optionally restore analytics

## Current State (Disabled Files)
- `lib/firebase_options.dart.disabled` - Old, needs regeneration
- `lib/src/services/firebase_analytics_service.dart.disabled` - Restore and update

## References
- Firebase removal commit: f95dea4
- TalkerAnalyticsService: lib/src/services/analytics_providers.dart
- FlutterFire docs: https://firebase.flutter.dev/docs/overview

## Estimate
3 story points (2-3 hours)
- 30 min: Firebase setup and configuration
- 1 hour: Code updates
- 1 hour: Testing across platforms

## Notes
- Keep TalkerAnalyticsService as backup/fallback
- Consider feature flag to disable Firebase in debug mode
- Ensure Firebase doesn't block demo mode functionality
